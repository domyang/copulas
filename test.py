import csv
import matplotlib.pyplot as plt
import matplotlib.patches as mpatches
from pyemd import emd
import math
from pylab import rcParams
import numpy as np
import scipy as sc
import dateutil.parser as dt
from dateutil.relativedelta import relativedelta
import spline
import copula_analysis as ca
import copula as cop
import copulaMS as cms
import copulaModels as mod
import utilities as ut
import subsetModel as sub
import sys

home_dir='/home/ambroiseidoine/UCD/'
sys.path.append(home_dir+'code/prescient/release/Prescient_1.0/')

import exec.MasterOptions as MasterOptions


def test(nb):
    if nb==0:
        # temp=ca.get_data()
        # print(temp['date'][0:40])
        # print(temp['for'][0:400])
        # print(temp['date'][40:80])
        # print(temp['for'][40:80])
        #
        # date=['2013-07-01 01:00:00', '2013-07-01 02:00:00', '2013-07-01 03:00:00', '2013-07-01 04:00:00', '2013-07-01 05:00:00', '2013-07-01 06:00:00', '2013-07-01 07:00:00', '2013-07-01 08:00:00', '2013-07-01 09:00:00', '2013-07-01 10:00:00', '2013-07-01 11:00:00', '2013-07-01 12:00:00', '2013-07-01 13:00:00', '2013-07-01 14:00:00', '2013-07-01 15:00:00', '2013-07-01 16:00:00', '2013-07-01 17:00:00', '2013-07-01 18:00:00', '2013-07-02 19:00:00']
        # vect=[1969.84, 1902.99, 1768.13, 1708.09, 1656.86, 1410.82, 966.72, 665.22, 406.82, 387.98, 358.78, 397.84, 513.21, 655.53, 844.18, 1100.54, 1396.67, 1505.46, 1675.5]
        #
        # data={'forecast':vect.copy(),'forecast_d':vect.copy()}
        parameters={'offsets':[0,2,3],'date_range':('2012-07-01 18:00:00','2015-07-05 01:00:00'),'forecast':[(20,3000),(0,3000),(0,3000)],'type':'Wind','location':'total','kind':'forecasts'}
        parametersBis={'offsets':[0],'date_range':('2013-07-01 18:00:00','2015-07-05 01:00:00'),'forecast_d':[(900,2300)],'type':'Wind','location':'total','kind':'forecasts'}
        # copula=cop.CopulaManager(date,vect,data,parameters)
        #
        #
        # copula.pprint()
        # copula.update({'offsets':[0,2,3]})
        # 'date_range':('2013-07-01 01:00:00','2013-07-02 01:00:00'),
        #
        # date1=['2013-07-01 00:00:00', '2013-07-01 01:00:00', '2013-07-01 02:00:00', '2013-07-01 03:00:00', '2013-07-01 04:00:00', '2013-07-01 05:00:00', '2013-07-01 06:00:00', '2013-07-01 07:00:00', '2013-07-01 08:00:00', '2013-07-01 09:00:00', '2013-07-01 10:00:00', '2013-07-01 11:00:00', '2013-07-01 12:00:00', '2013-07-01 13:00:00', '2013-07-01 14:00:00', '2013-07-01 15:00:00', '2013-07-01 16:00:00', '2013-07-01 17:00:00', '2013-07-01 18:00:00', '2013-07-01 19:00:00', '2013-07-01 20:00:00', '2013-07-01 21:00:00', '2013-07-01 22:00:00', '2013-07-01 23:00:00', '2013-07-02 00:00:00', '2013-07-02 01:00:00', '2013-07-02 02:00:00', '2013-07-02 03:00:00', '2013-07-02 04:00:00', '2013-07-02 05:00:00', '2013-07-02 06:00:00', '2013-07-02 07:00:00', '2013-07-02 08:00:00', '2013-07-02 09:00:00', '2013-07-02 10:00:00', '2013-07-02 11:00:00', '2013-07-02 12:00:00', '2013-07-02 13:00:00', '2013-07-02 14:00:00', '2013-07-02 15:00:00']
        # vect1=[2031.94, 1969.84, 1902.99, 1768.13, 1708.09, 1656.86, 1410.82, 966.72, 665.22, 406.82, 387.98, 358.78, 397.84, 513.21, 655.53, 844.18, 1100.54, 1396.67, 1505.46, 1675.5, 1783.19, 1841.93, 1952.97, 1936.44, 2101.08, 1955.53, 1824.13, 1691.73, 1578.94, 1504.61, 1273.85, 993.59, 675.23, 519.87, 499.19, 533.36, 699.39, 995.28, 1288.79, 1575.79]
        # date2=['2013-07-01 11:00:00', '2013-07-01 12:00:00', '2013-07-01 13:00:00', '2013-07-01 14:00:00', '2013-07-01 15:00:00', '2013-07-01 16:00:00', '2013-07-01 17:00:00', '2013-07-01 18:00:00', '2013-07-01 19:00:00', '2013-07-01 20:00:00', '2013-07-01 21:00:00', '2013-07-01 22:00:00', '2013-07-01 23:00:00', '2013-07-02 00:00:00', '2013-07-02 01:00:00', '2013-07-02 02:00:00', '2013-07-02 03:00:00', '2013-07-02 04:00:00', '2013-07-02 05:00:00', '2013-07-02 06:00:00', '2013-07-02 07:00:00', '2013-07-02 08:00:00', '2013-07-02 09:00:00', '2013-07-02 10:00:00', '2013-07-02 11:00:00', '2013-07-02 12:00:00', '2013-07-02 13:00:00', '2013-07-02 14:00:00', '2013-07-02 15:00:00', '2013-07-02 16:00:00', '2013-07-02 17:00:00', '2013-07-02 18:00:00', '2013-07-02 19:00:00', '2013-07-02 20:00:00', '2013-07-02 21:00:00', '2013-07-02 22:00:00', '2013-07-02 23:00:00', '2013-07-03 00:00:00', '2013-07-03 01:00:00', '2013-07-03 02:00:00']
        # vect2=[1835.31, 2114.72, 2309.66, 2520.13, 2568.29, 2580.37, 2554.45, 2512.46, 2597.03, 2575.16, 2563.37, 2489.02, 2442.23, 2382.31, 2208.99, 1996.35, 1802.28, 1545.94, 1388.88, 1375.43, 1560.8, 1758.01, 2017.89, 2262.1, 2412.6, 2488.16, 2534.95, 2628.69, 2661.06, 2667.08, 2669.89, 2641.8, 2574.98, 2528.24, 2429.19, 2304.81, 2235.64, 2142.3, 1915.04, 1692.6]
        # data1={'forecast':vect1.copy(),'forecast_d':vect1.copy()}
        # data2={'forecast':vect2.copy(),'forecast_d':vect2.copy()}
        #
        # copula=cop.CopulaManager(date1,vect1,data1,parameters)
        # copula.pprint()
        # copula=cop.CopulaManager(date2,vect2,data2,parameters)
        #
        title1={'type':'Solar','location':'NP','kind':'error'}
        title2={'type':'Wind','location':'NP','kind':'error'}
        title3={'type':'Solar','location':'SP','kind':'error'}
        title4={'type':'Wind','location':'SP','kind':'error'}
        titles=[title1,title2,title3,title4]
        # series=[{'date':date1,'vect':vect1,'data':data1,'title':title},{'date':date2,'vect':vect2,'data':data2,'title':title},{'date':date2,'vect':vect2,'data':data2,'title':title}]
        # copula=cms.CopulaManagerMS(series,parameters,[None,None,parametersBis])
        # copula.pprint()

        copula=ca.create_copulaManager(titles,parameters)
        copula.pprint()

    elif nb==1:
        abscisses=[x/24 for x in range(400)]
        l=[2031.94, 1969.84, 1902.99, 1768.13, 1708.09, 1656.86, 1410.82, 966.72, 665.22, 406.82, 387.98, 358.78, 397.84, 513.21, 655.53, 844.18, 1100.54, 1396.67, 1505.46, 1675.5, 1783.19, 1841.93, 1952.97, 1936.44, 2101.08, 1955.53, 1824.13, 1691.73, 1578.94, 1504.61, 1273.85, 993.59, 675.23, 519.87, 499.19, 533.36, 699.39, 995.28, 1288.79, 1575.79, 1835.31, 2114.72, 2309.66, 2520.13, 2568.29, 2580.37, 2554.45, 2512.46, 2597.03, 2575.16, 2563.37, 2489.02, 2442.23, 2382.31, 2208.99, 1996.35, 1802.28, 1545.94, 1388.88, 1375.43, 1560.8, 1758.01, 2017.89, 2262.1, 2412.6, 2488.16, 2534.95, 2628.69, 2661.06, 2667.08, 2669.89, 2641.8, 2574.98, 2528.24, 2429.19, 2304.81, 2235.64, 2142.3, 1915.04, 1692.6, 1431.73, 1117.0, 891.15, 845.86, 942.28, 1171.54, 1577.37, 1901.06, 2070.42, 2173.46, 2193.13, 2268.57, 2305.93, 2399.98, 2396.6, 2326.04, 2281.83, 2175.67, 2097.2, 2000.68, 1968.21, 1923.81, 1758.01, 1628.07, 1467.03, 1267.06, 1128.58, 1160.43, 1279.98, 1444.75, 1616.0, 1764.04, 1906.66, 1947.52, 1945.65, 1922.33, 1980.36, 2033.9, 2001.98, 1857.66, 1711.88, 1654.41, 1555.63, 1451.41, 1364.15, 1286.05, 1064.79, 766.15, 520.7, 383.68, 373.13, 426.39, 520.41, 644.33, 785.57, 977.55, 1332.35, 1470.82, 1533.86, 1669.98, 1896.93, 2028.22, 2110.14, 2096.26, 1832.08, 1823.7, 1760.72, 1671.99, 1608.37, 1540.3, 1337.69, 1017.01, 710.44, 516.87, 438.67, 427.35, 503.27, 634.88, 830.14, 1107.89, 1441.33, 1638.99, 1725.61, 1928.71, 2075.48, 2149.06, 2185.82, 2174.86, 2107.85, 2038.72, 1998.03, 1930.38, 1907.38, 1835.67, 1589.96, 1209.61, 877.37, 677.55, 575.87, 537.98, 631.06, 800.16, 1004.99, 1252.84, 1522.52, 1698.52, 1775.9, 1931.33, 1991.69, 2076.35, 2094.94, 2072.21, 2092.95, 2041.73, 2015.97, 1951.73, 1891.99, 1829.83, 1608.72, 1241.17, 932.68, 680.86, 573.45, 591.25, 719.45, 912.65, 1101.69, 1302.36, 1559.46, 1821.17, 1909.3, 1979.69, 2086.77, 2182.86, 2206.79, 2197.3, 2015.72, 1972.07, 1936.23, 1833.0, 1797.76, 1795.74, 1643.62, 1313.64, 982.98, 741.03, 612.59, 622.98, 753.57, 979.86, 1241.31, 1586.94, 1816.52, 1947.08, 1982.66, 1940.59, 2049.35, 2138.2, 2133.25, 2093.76, 2065.82, 1952.19, 1944.78, 1903.9, 1902.46, 1829.9, 1580.53, 1423.99, 1268.97, 1038.4, 843.33, 773.16, 833.3, 962.29, 1157.18, 1460.71, 1627.49, 1688.16, 1623.65, 1613.39, 1640.68, 1713.62, 1807.49, 1834.81, 2231.48, 2186.71, 2053.6, 1879.52, 1798.2, 1705.72, 1556.97, 1202.37, 914.29, 756.5, 607.23, 600.78, 690.32, 832.42, 1024.77, 1300.1, 1595.03, 1763.28, 1796.74, 1866.32, 2028.88, 2106.52, 2131.6, 2141.97, 2081.35, 2056.19, 2006.9, 1922.14, 1835.0, 1708.67, 1484.01, 1103.12, 745.18, 524.38, 430.3, 434.45, 546.41, 676.73, 850.98, 1110.58, 1419.17, 1650.13, 1727.08, 1843.76, 1961.59, 2025.51, 2016.43, 2039.39, 1911.33, 1858.71, 1810.81, 1738.17, 1714.69, 1648.77, 1498.87, 1261.09, 1013.41, 753.4, 560.95, 501.49, 561.68, 758.49, 1062.02, 1460.99, 1736.24, 1896.54, 1945.22, 2009.46, 2063.96, 2105.24, 2117.82, 2177.72, 2108.92, 2076.49, 2039.54, 1976.35, 1929.88, 1862.78, 1728.83, 1491.91, 1208.84, 960.81, 792.29, 753.41, 856.34, 1019.22, 1197.57, 1375.1, 1557.68, 1690.83, 1729.2, 1793.26, 1884.08, 1982.41, 2012.06, 1995.59, 1859.25, 1774.29, 1693.14, 1624.87, 1589.85, 1485.05, 1299.76, 1069.69, 902.37, 804.48, 765.27, 777.45, 846.75, 992.12, 1158.6, 1309.7, 1403.44, 1446.91, 1448.23, 1505.86, 1729.06, 1928.93, 1995.42, 1945.5, 1989.95, 1913.64, 1829.68, 1742.62, 1680.86, 1605.49, 1433.65, 1140.89, 823.48, 497.01, 362.39, 329.29, 347.23, 420.83, 589.92, 834.34]
        ld=ut.list_derivative(l)
        for i in range(len(ld)):
            ld[i]*=1
        print('l: %d ld: %d' % (len(l),len(ld)))
        print(l)
        print(ld)
        plt.figure()
        plt.plot(abscisses,l)
        plt.plot(abscisses,ld)
        plt.show()
    elif nb==2:
        parameters={'offsets':[8,13,18],'date_range':('2014-01-01 00:00:00','2015-12-31 23:00:00'),'first_hour':(0,0)}
        titles=[{'type':'Solar','location':'total','kind':'error'}]
        copula=ca.create_copulaManager(titles,parameters)
        # copula.plot()
        parameters['first_hour']=(-2,2)
        copula.update(parameters)
        copula.plot()
        copula.pprint()
        copula.get_corner_points()
        for i in copula.copulae:
            i.pprint()
            print(i.date[1:200])
            print(i.vect[1:200])
            print(i.dateM[1:100])
            print(i.vectM[1:100])


    elif nb==3:
        l=ca.get_data(type='Solar')
        print(l['date'][:100])
        print(l['for'][:100])
        print(l['act'][:100])
    elif nb==4:

        parameters={'offsets':[11,13],'date_range':('2014-01-01 00:00:00','2015-12-31 23:00:00'),'first_hour':(-5,5)}
        titles=[{'type':'Wind','location':'total','kind':'error'}]
        copula=ca.create_copulaManager(titles,parameters)
        copula.pprint()
        copula.copulae[0].plot2D()
        copula.plot2D()

    else:
        pass

# test(2)
# plt.show()

### This function determines whether there is a significant accuracy improvement when predicting Solar power forecast errors
### as a function of solar hours, as compared to a function of clock hour
def solar_hours():

    # fetching the data
    l=ca.get_data(type='Solar')
    length=len(l['date'])
    error=[l['act'][i]-l['for'][i] for i in range(length)]
    d=l['date'].copy();e=error.copy();f=l['for'].copy()
    value_sol=[[] for i in range(36)]
    value_std=[[]for i in range(24)]
    date_sol=[]
    date_std=[]

    # renormalizing the errors by square root of the maximum forecast (proportional to the number of generators...)
    renormalized_error=[]
    f_max=1
    forecast_max=[]
    for i in f:
        f_max=max(f_max,i)
        forecast_max.append(f_max)

    for i in range(length-50):
        time=dt.parse(d.pop())
        err=e.pop()/math.sqrt(forecast_max.pop())

        # estimating the solar hour
        value_std[time.hour].append(err)
        rise,set=ut.sun_rise_set('%d-%d-%d'%(time.year,time.month,time.day))
        sol_hour=((time.hour+time.minute/60+time.second/3600)-rise)/(set-rise)*12+12
        value_sol[round(sol_hour)].append(err)

        date_sol.append(sol_hour)
        date_std.append((time.hour+time.minute/60+time.second/3600))
        renormalized_error.append(err)

    # computing the squared error as a function of time
    mean_sol=[]
    for i in value_sol:
        if len(i)>0:
            mean_sol.append(np.mean(i))
        else:
            mean_sol.append(0)
    mean_std=[]
    for i in value_std:
        if len(i)>0:
            mean_std.append(np.mean(i))
        else:
            mean_std.append(0)

    var_sol_for_mean=[[] for i in range(36)]
    var_std_for_mean=[[] for i in range(24)]
    var_sol=[]
    var_std=[]

    for i in zip(renormalized_error,date_sol,date_std):
        temp=(i[0]-mean_std[int(i[2])])**2
        var_std_for_mean[round(i[2])].append(temp)
        var_std.append(temp)
        temp=(i[0]-(i[1]%1*mean_sol[int(math.ceil(i[1]))]+(1-i[1]%1)*mean_sol[int(math.floor(i[1]))]))**2
        var_sol_for_mean[round(i[1])].append(temp)
        var_sol.append(temp)

    # computing the squared error of the squared error as a function of time
    mean_var_sol=[]
    for i in var_sol_for_mean:
        if len(i)>0:
            mean_var_sol.append(np.mean(i))
        else:
            mean_var_sol.append(0)
    mean_var_std=[]
    for i in var_std_for_mean:
        if len(i)>0:
            mean_var_std.append(np.mean(i))
        else:
            mean_var_std.append(0)

    var_square_sol=0
    var_square_std=0


    for i in zip(var_sol,var_std,date_sol,date_std):
        print(i)
        print((i[1]-mean_var_std[int(i[3])])**2)
        var_square_std+=(i[1]-mean_var_std[int(i[3])])**2
        var_square_sol+=(i[0]-(i[2]%1*mean_var_sol[int(math.ceil(i[2]))]+(1-i[2]%1)*mean_var_sol[int(math.floor(i[2]))]))**2


    print('variance of the square - solar:%f, - standard:%f'%(var_square_sol**0.25/length,var_square_std**0.25/length))


    plt.figure()
    plt.title('renormalized error as a function of solar hour')
    plt.plot(date_sol,renormalized_error,'.')

    plt.figure()
    plt.title('renormalized error as a function of clock hour')
    plt.plot(date_std,renormalized_error,'.')


    plt.figure()
    plt.title('square error as a function of solar hour')
    plt.plot(date_sol,var_sol,'.')

    plt.figure()
    plt.title('square error as a function of clock hour')
    plt.plot(date_std,var_std,'.')

    plt.figure()
    plt.boxplot(value_sol)

    plt.figure()
    plt.boxplot(value_std)

    plt.show()

def spatial_correlation(offset_max=10, type='Wind'):
    parameters={'offsets':[0],'date_range':('2013-07-01 18:00:00','2015-07-05 01:00:00')}
    title1={'type':type,'location':'NP','kind':'error'}
    title2={'type':type,'location':'SP','kind':'error'}
    titles=[title1,title2]
    copula=ca.create_copulaManager(titles,parameters)

    x=copula.vectM[0]
    y=copula.vectM[1]
    mx=np.mean(x)
    my=np.mean(y)
    x=[i-mx for i in x]
    y=[i-my for i in y]
    off=2*offset_max+1
    buff=x[:off]
    index=off-1
    correlations=[0 for i in range(off)]
    for i in zip(x[2*offset_max:],y[offset_max:-offset_max]):
        buff[index]=i[0]
        index= (index+1)%off
        for j in range(off):
            correlations[j]+=i[1]*buff[(index+j)%off]
    length=copula.lengthM-off
    correlations=[i/length for i in correlations]
    plt.figure()
    plt.plot(range(-offset_max,offset_max+1),correlations)
    plt.title('spatial correlation as a function of lag time between south and north california')

    x=copula.unifM[0]
    y=copula.unifM[1]
    mx=np.mean(x)
    my=np.mean(y)
    x=[i-mx for i in x]
    y=[i-my for i in y]
    off=2*offset_max+1
    buff=x[:off]
    index=off-1
    correlations=[0 for i in range(off)]
    for i in zip(x[2*offset_max:],y[offset_max:-offset_max]):
        buff[index]=i[0]
        index= (index+1)%off
        for j in range(off):
            correlations[j]+=i[1]*buff[(index+j)%off]
    correlations=[i/length for i in correlations]
    plt.figure()
    plt.plot(range(-offset_max,offset_max+1),correlations)
    plt.title('spatial correlation (Kendall tau) as a function of lag time between south and north california')

def type_correlation():
    parameters={'offsets':[0],'date_range':('2013-01-01 18:00:00','2015-07-05 01:00:00')}
    parameters1={'offsets':[0,4],'date_range':('2013-01-01 18:00:00','2015-07-05 01:00:00')}
    list_parameters=[parameters,parameters1]
    title1={'type':'Solar','location':'total','kind':'error'}
    title2={'type':'Wind','location':'total','kind':'error'}
    titles=[title1,title2]
    copula=ca.create_copulaManager(titles,parameters1,list_parameters=list_parameters)
    copula.pprint()
    copula.plot()
    plt.show()

def tails(type='Wind'):
    # parameters={'offsets':[8,13,18],'date_range':('2013-07-01 18:00:00','2015-07-05 01:00:00'),'first_hour':(-5,5)}
    # titles=[{'type':type,'location':'NP','kind':'error'}]
    # copula=ca.create_copulaManager(titles,parameters)
    # copula.plot()
    # copula.tails()
    u1=[0.4445092484586072, 0.4723379436760725, 0.4870021663056351, 0.5069988335277659, 0.498000333277807, 0.5078320279953547, 0.5793201133144722, 0.5734877520413507, 0.5958173637727301, 0.5581569738377171, 0.5608231961340012, 0.5528245292451489, 0.5388268621896574, 0.5461589735044386, 0.5483252791201695, 0.5451591401433321, 0.547992001333134, 0.508998500249979, 0.5056657223796238, 0.5049991668055528, 0.49250124979172105, 0.5113314447592275, 0.4930011664722743, 0.4811698050325136, 0.465172471254809, 0.4605065822363118, 0.4168471921346596, 0.42001333111149697, 0.3666888851858149, 0.47750374937512297, 0.7276287285452755, 0.7771204799200492, 0.8297783702716602, 0.9089318446925946, 0.8207798700217014, 0.6979670054991148, 0.720463256124012, 0.6853024495917653, 0.5526578903516312, 0.30586568905183376, 0.25337443759374045, 0.292701216463931, 0.3753541076487382, 0.40584902516248766, 0.36918846858858123, 0.3190301616397365, 0.33619396767206544, 0.34452591234795327, 0.4210131644726035, 0.446675554074338, 0.39135144142644285, 0.395350774870869, 0.472671221463108, 0.5984835860690142, 0.5649891684719451, 0.574654224295975, 0.5721546408932087, 0.5658223629395339, 0.5523246125645956, 0.5619896683886255, 0.5604899183469657, 0.3060323279453515, 0.3178636893851122, 0.43701049825030813, 0.6064822529578665, 0.5791534744209544, 0.4026828861856503, 0.46917180469923514, 0.5934844192634815, 0.7107982002999821, 0.6976337277120793, 0.7059656723879671, 0.982586235627443, 0.9910848191968485, 0.9945842359607214, 0.9895850691551887, 0.913431094817574, 0.7547908681886698, 0.5749875020830105, 0.632811198133672, 0.6101483086152572, 0.7627895350775221, 0.8166138976837575, 0.9350941509748824, 0.9420929845026281, 0.8402766205632789, 0.7797867022163333, 0.650641559740072, 0.2930344942509665, 0.2853691051491497, 0.3336943842692991, 0.7736210631561763, 0.9232627895351216, 0.9367605399100599, 0.765622396267324, 0.7787868688552267, 0.8106148975171182, 0.8142809531745089, 0.7586235627395782, 0.9639226795534542, 0.9614230961506879, 0.9624229295117944, 0.9622562906182767, 0.9655890684886318, 0.9762539576737682, 0.23721046492251807, 0.2615397433761105, 0.32736210631562435, 0.3711881353107943, 0.47217130478255476, 0.6476420596567524, 0.707465422429627, 0.8536077320446994, 0.811448091984707, 0.636977170471616, 0.41934677553742594, 0.24137643726046198, 0.7304615897350774, 0.9877520413264934, 0.99691718046997, 0.9915847358774018, 0.9787535410765346, 0.9155974004333048, 0.9070988168638993, 0.9239293451091927, 0.8996000666556002, 0.8259456757207518, 0.38601899683387464, 0.12656223962672775, 0.13989335110814827, 0.22937843692718352, 0.24370938176971058, 0.3080319946675646, 0.3550241626395719, 0.30786535577404683, 0.2942009665055908, 0.3076987168805291, 0.3463589401766486, 0.3340276620563346, 0.5083319446759079, 0.46183969338445385, 0.6461423096150926, 0.7187968671888344, 0.6598066988835486, 0.45184135977338846, 0.3950174970838335, 0.3271954674221066, 0.3036993834361029, 0.2535410764872582, 0.305699050158316, 0.24904182636227878, 0.25220796533911616, 0.4245125812364764, 0.4751708048658744, 0.4750041659723566, 0.4478420263289623, 0.4318446925512577, 0.4321779703382932, 0.45534077653726135, 0.4203466088985325, 0.4623396100650071, 0.4835027495417622, 0.4758373604399454, 0.6199800033328048, 0.682136310614928, 0.7309615064156306, 0.6961339776704195, 0.6644725879020458, 0.645142476253986, 0.6563072821196757, 0.5804865855690965, 0.47150474920848373, 0.4573404432594744, 0.46000666555575853, 0.5519913347775601, 0.58765205799036, 0.6169805032494852, 0.6121479753374702, 0.5976503916014254, 0.5989835027495675, 0.5784869188468834, 0.5594900849858592, 0.34269288451925795, 0.3803532744542709, 0.39101816363940733, 0.49100149975006124, 0.5443259456757433, 0.5786535577404012, 0.6069821696384198, 0.6189801699716982, 0.6043159473421357, 0.5871521413098068, 0.5551574737543975, 0.4670054990835043, 0.42884519246793806, 0.4340109981669885, 0.515830694884207, 0.5326612231295004, 0.5516580569905246, 0.5578236960506816, 0.5644892517913919, 0.5558240293284685, 0.5463256123979564, 0.5283286118980387, 0.30819863356108235, 0.3431928011998112, 0.4766705549075342, 0.5679886685552648, 0.581486418930203, 0.600649891684745, 0.6508081986335897, 0.6641393101150103, 0.658806865522442, 0.63147808698553, 0.5673221129811937, 0.5344942509581957, 0.6338110314947786, 0.6349775037494029, 0.5904849191801619, 0.5688218630228535, 0.6268121979670328, 0.6751374770871822, 0.6831361439760345, 0.6463089485086103, 0.5788201966339189, 0.5269955007498967, 0.3171971338110412, 0.33036160639894396, 0.3210298283619496, 0.344692551241471, 0.33352774537578134, 0.33919346775538506, 0.3475254124312729, 0.36368938510249527, 0.4061823029495232, 0.43001166472256236, 0.5773204465922591, 0.1305615730711539, 0.1597233794367613, 0.203049491751378, 0.35802366272289154, 0.6371438093651337, 0.6904682552908158, 0.8171138143643107, 0.8976003999333871, 0.9150974837527516, 0.939426762206344, 0.9224295950675329, 0.3198633561073253, 0.2808698550241703, 0.49066822196302573, 0.6036493917680646, 0.6616397267122439, 0.6868021996334251, 0.8062822862856566, 0.8499416763873088, 0.8129478420263668, 0.8276120646559294, 0.8014497583736416, 0.5353274454257845, 0.5438260289951901, 0.4160139976670708, 0.31619730044993466, 0.3523579403432878, 0.4740043326112501, 0.45450758206967257, 0.4481753041159978, 0.4271788035327605, 0.3703549408432055, 0.32852857857024864, 0.280369938343617, 0.24037660389935545, 0.2213797700383312, 0.26720546575571424, 0.30436593901017395, 0.39635060823197554, 0.33386102316281685, 0.2565405765705778, 0.17522079653391265, 0.13272787868688474, 0.22504582569572185, 0.8609398433594807, 0.8896017330445348, 0.797783702716251, 0.7186302282953166, 0.6871354774204607, 0.8226128978503967, 0.7599566738877203, 0.7714547575404455, 0.9015997333778133, 0.9199300116647665, 0.8639393434428003, 0.9137643726046095, 0.8599400099983742, 0.6518080319946963, 0.6843026162306588, 0.4900016663889547, 0.24187635394101525, 0.1550574904182641, 0.13006165639060063, 0.5878186968838778, 0.6283119480086926, 0.43317780369939973, 0.12506248958506794, 0.16572237960340053, 0.34919180136645045, 0.21554740876520972, 0.13489418430261557, 0.2720379936677292, 0.4366772204632726, 0.803949341776408, 0.84910848191972, 0.6993001166472569, 0.1915514080986528, 0.004082652891184802, 0.04790868188635247, 0.06840526578903543, 0.03174470921513076, 0.035077487085485755, 0.02607898683552739, 0.05257457090484946, 0.06157307115480794, 0.054740876520580205, 0.054407598733544706, 0.039243459423429494, 0.02691218130311612, 0.009915014164305958, 0.010748208631894697, 0.00474920846525579, 0.008248625229128479, 0.018580236627228814, 0.02907848691884682, 0.012414597567072175, 0.017747042159640083, 0.01791368105315783, 0.03324445925679051, 0.08256957173804355, 0.07040493251124834, 0.2122146308948546, 0.164722546242294, 0.13256123979336698, 0.20254957507082472, 0.17572071321446592, 0.18821863022829766, 0.28903516080654035, 0.35335777370439436, 0.3383602732877963, 0.4215130811531568, 0.6221463089485356, 0.5224962506249172, 0.39318446925513817, 0.6028161973004759, 0.6203132811198403, 0.9052657890352039, 0.8897683719380526, 0.9472587902016786, 0.9587568738544038, 0.8877687052158395, 0.677970338276984, 0.854607565405806, 0.8261123146142696, 0.8907682052991591, 0.9339276787202581, 0.9742542909515551, 0.9897517080487065, 0.9889185135811177, 0.9294284285952786, 0.8899350108315703, 0.8094484252624939, 0.8347775370771929, 0.8992667888685647, 0.868271954674262, 0.7864522579570435, 0.7366272287952343, 0.6836360606565878, 0.7571238126979184, 0.8579403432761611, 0.8009498416930884, 0.844275954007705, 0.8666055657390844, 0.6548075320780159, 0.8132811198134023, 0.9365939010165422, 0.9234294284286394, 0.7534577570405278, 0.2267122146308994, 0.11223129478420174, 0.14339276787202115, 0.2617063822696283, 0.07907015497417096, 0.14072654557573705, 0.15872354607565475, 0.293367772038002, 0.6701383102816495, 0.9445925679053945, 0.9597567072155103, 0.9469255124146431, 0.9415930678220749, 0.8951008165306208, 0.7811198133644753]
    u2=[0.4761706382269809, 0.4970004999167005, 0.48750208298618836, 0.49783369438428926, 0.4858356940510108, 0.47950341609733604, 0.5846525579070404, 0.5474920846525807, 0.5504915847359003, 0.5421596400600125, 0.5274954174304499, 0.5354940843193022, 0.5376603899350331, 0.5348275287452312, 0.5373271121479976, 0.5361606398933733, 0.5341609731711602, 0.4946675554074519, 0.4816697217130669, 0.5014997500416799, 0.48216963839362015, 0.4700049991668239, 0.45450758206967257, 0.44884185969006885, 0.40518246958841664, 0.40851524745877177, 0.42167972004667453, 0.4866688885185996, 0.7186302282953166, 0.765622396267324, 0.8221129811698434, 0.9045992334611329, 0.8124479253458136, 0.6909681719713691, 0.7124645892351597, 0.6764705882353242, 0.5419930011664947, 0.5386602232961396, 0.734794200966539, 0.2880353274454338, 0.36485585735711956, 0.3950174970838335, 0.3590234960839981, 0.31203132811199075, 0.3290284952508019, 0.3363606065655832, 0.40934844192636055, 0.43467755374105954, 0.42651224795868947, 0.4098483586069138, 0.4620063322779716, 0.586985502416289, 0.5539910014997732, 0.5636560573238031, 0.5611564739210367, 0.5551574737543975, 0.5416597233794592, 0.5516580569905246, 0.5501583069488648, 0.5563239460090218, 0.5588235294117881, 0.42551241459758293, 0.5958173637727301, 0.5683219463423003, 0.3920179970005139, 0.45834027662058097, 0.5824862522913096, 0.7044659223463073, 0.6906348941843335, 0.6994667555407746, 0.7132977837027484, 0.7846192301283482, 0.9945842359607214, 0.990084985835742, 0.9089318446925946, 0.7451258123646399, 0.5639893351108386, 0.6233127812031599, 0.5996500583236385, 0.751958006998868, 0.8079486752208341, 0.919596733877731, 0.9520913181136935, 0.8344442592901574, 0.7682886185636081, 0.6408098650225243, 0.2883686052324693, 0.28103649391768804, 0.32652891184803556, 0.7622896183969688, 0.9184302616231067, 0.9320946508915627, 0.9544242626229421, 0.9795867355441233, 0.8011164805866061, 0.8054490918180678, 0.747792034660924, 0.9632561239793832, 0.9600899850025458, 0.9615897350442056, 0.9609231794701346, 0.964755874021043, 0.9755874020996972, 0.9240959840027104, 0.8257790368272341, 0.3203632727878786, 0.3616897183802822, 0.4616730544909361, 0.6384769205132758, 0.7009665055824345, 0.8492751208132377, 0.8021163139477127, 0.6273121146475861, 0.40751541409766523, 0.5719880019996909, 0.15455757373771084, 0.9882519580070467, 0.99691718046997, 0.9919180136644373, 0.9780869855024635, 0.9107648725212899, 0.9029328445259553, 0.9190968171971777, 0.8947675387435853, 0.8187802032994883, 0.7027995334111298, 0.8159473421096864, 0.13989335110814827, 0.22471254790868633, 0.23921013164473115, 0.30236627228796087, 0.3458590234960953, 0.3021996333944431, 0.2900349941676469, 0.30203299450092536, 0.33802699550076076, 0.2960339943342861, 0.23987668721880218, 0.45034160973172865, 0.636977170471616, 0.7111314780870176, 0.6508081986335897, 0.44034327612066326, 0.38451924679221483, 0.3201966338943608, 0.298866855524088, 0.24904182636227878, 0.2705382436260694, 0.22654557573738165, 0.2478753541076545, 0.4126812197967157, 0.46417263789370244, 0.4640059990001847, 0.4356773871021661, 0.4203466088985325, 0.420679886685568, 0.44384269288453615, 0.4086818863522895, 0.43351108148643525, 0.4678386935510931, 0.46483919346777347, 0.6104815864022927, 0.6739710048325579, 0.7221296450591895, 0.6893017830361915, 0.6558073654391224, 0.6358106982169917, 0.6466422262956458, 0.5699883352774778, 0.6171471421430029, 0.651308115314143, 0.4483419430095156, 0.541159806698906, 0.5769871688052236, 0.6063156140643488, 0.6016497250458516, 0.5864855857357357, 0.5874854190968423, 0.5676553907682292, 0.5491584735877583, 0.5339943342776424, 0.5404932511248349, 0.38018663556075316, 0.48016997167140707, 0.5334944175970892, 0.567822029661747, 0.5964839193468011, 0.6093151141476684, 0.5933177803699637, 0.5764872521246703, 0.5448258623562966, 0.5443259456757433, 0.5384935844026218, 0.42284619230129883, 0.5059990001666593, 0.522662889518435, 0.5409931678053882, 0.547325445759063, 0.5533244459257022, 0.5453257790368499, 0.53566072321282, 0.5179970004999378, 0.4950008331944874, 0.433677720379953, 0.46533911014832674, 0.5569905015830928, 0.5709881686385844, 0.5893184469255376, 0.6411431428095599, 0.6554740876520869, 0.6498083652724832, 0.6219796700550179, 0.5564905849025396, 0.547992001333134, 0.5661556407265694, 0.6249791701383375, 0.5796533911015077, 0.5578236960506816, 0.6169805032494852, 0.6666388935177766, 0.6748041993001467, 0.6373104482586515, 0.5679886685552648, 0.5163306115647602, 0.48683552741211733, 0.433011164805882, 0.3140309948342038, 0.33652724545910095, 0.32619563406100005, 0.3313614397600505, 0.3390268288618673, 0.3536910514914299, 0.39518413597735125, 0.4183469421763194, 0.5664889185136049, 0.6479753374437879, 0.6731378103649691, 0.19905015830695183, 0.3490251624729327, 0.6274787535411038, 0.6833027828695523, 0.8084485919013874, 0.8927678720213722, 0.9102649558407366, 0.9350941509748824, 0.9175970671555179, 0.9005999000167068, 0.8297783702716602, 0.47983669388437156, 0.5928178636894105, 0.6529745042493206, 0.6784702549575373, 0.7961173137810734, 0.8451091484752938, 0.803949341776408, 0.8202799533411481, 0.7907848691885052, 0.7182969505082811, 0.6101483086152572, 0.4045159140143456, 0.3095317447092244, 0.34335944009332897, 0.46300616563907815, 0.4428428595234296, 0.43617730378271935, 0.4153474420929998, 0.36068988501917565, 0.32152974504250287, 0.18338610231628272, 0.11239793367771948, 0.2175470754874228, 0.2628728545242526, 0.299533411098159, 0.3856857190468391, 0.3266955507415533, 0.2523746042326339, 0.17088818530245098, 0.13272787868688474, 0.22037993667722466, 0.26603899350108995, 0.17405432427928835, 0.7869521746375968, 0.7109648391934998, 0.6789701716380906, 0.8146142309615444, 0.7491251458090661, 0.7602899516747558, 0.8969338443593161, 0.9150974837527516, 0.8599400099983742, 0.841609731711421, 0.9424262622896636, 0.6419763372771486, 0.6756373937677355, 0.47917013831030053, 0.23704382602900032, 0.15272454590901552, 0.12956173971004736, 0.5771538076987414, 0.6183136143976272, 0.4218463589401923, 0.22621229795034614, 0.568488585235818, 0.3408598566905626, 0.21154807532078357, 0.13489418430261557, 0.2677053824362675, 0.4251791368105474, 0.7939510081653426, 0.8444425929012228, 0.6924679220130289, 0.18671888018663785, 0.1957173804365967, 0.18405265789035374, 0.07273787702049674, 0.035577403766039004, 0.038743542742876245, 0.029578403599400057, 0.05690718213631095, 0.06623896017330477, 0.05940676553907719, 0.059073487752041694, 0.043242792867855484, 0.025079153474420912, 0.054407598733544706, 0.013247792034660914, 0.005415764039326778, 0.010248291951341453, 0.021079820029995006, 0.03241126478920176, 0.015247458756873888, 0.02041326445592402, 0.020579903349441767, 0.0372437927012165, 0.04457590401599748, 0.0632394600899854, 0.2083819363439462, 0.1608898516913856, 0.13189468421929595, 0.19788368605232753, 0.1712214630894865, 0.18371938010331823, 0.2842026328945254, 0.344692551241471, 0.3306948841859795, 0.5839860023329694, 0.5118313614397808, 0.5124979170138518, 0.3831861356440728, 0.5919846692218217, 0.6108148641893282, 0.9009331778037423, 0.8847692051325199, 0.9439260123313234, 0.957257123812744, 0.8832694550908601, 0.8514414264289686, 0.45384102649560154, 0.8189468421930061, 0.8859356773871442, 0.9290951508082431, 0.9734210964839664, 0.9902516247292598, 0.989418430261671, 0.9247625395767815, 0.8851024829195554, 0.7996167305449463, 0.8119480086652603, 0.899766705549118, 0.8644392601233536, 0.7749541743043183, 0.7274620896517577, 0.6751374770871822, 0.7466255624062997, 0.8537743709382172, 0.7899516747209164, 0.8391101483086546, 0.8626062322946583, 0.912097983669432, 0.9110981503083254, 0.931928011998045, 0.9187635394101422, 0.7437927012164979, 0.22204632561240223, 0.1132311281453082, 0.14272621229795013, 0.2578736877187199, 0.08240293284452581, 0.14072654557573705, 0.5413264455924237, 0.6686385602399897, 0.6614730878187262, 0.9409265122480038, 0.9582569571738505, 0.9435927345442879, 0.9375937343776487, 0.8901016497250881, 0.7694550908182324, 0.25337443759374045, 0.05374104315947371]
    tails=cms.tails_ut([u1,u2],interpolation='epi-splines',visualize=True)

def marginals_test():
    v1=[339.66808000000003, 228.15043000000003, 58.282749999999965, 59.47607000000005, 133.58475999999996, 218.4837, 71.79204000000004, 217.99871000000007, 262.0764600000001, 355.65107, 372.01240999999993, 187.85753, 76.86381999999998, -35.669550000000015, -76.26421000000005, -144.28190999999998, -147.46757000000002, 72.24315000000001, 82.63990000000001, 15.725579999999923, 2.168890000000033, 148.28864, 103.93889999999993, 10.009040000000027, 47.406769999999995, 40.88998000000001, 6.094059999999985, -56.20863000000003, -347.65097, -355.4663800000001, -225.69981000000007, -93.23589000000004, -87.36979000000002, -145.31024000000002, -167.44148, -156.84122999999997, -104.15993999999998, -98.40488999999997, 55.79105999999996, 98.53159000000005, 47.79126999999994, 113.02796999999998, 225.34524999999996, 327.97314, 263.69006, 86.86847, 20.50632999999999, -4.680049999999994, 33.54959000000002, -44.69394, 155.13872000000003, 28.84770000000003, 48.82072000000005, 20.160939999999982, 65.32898, 17.04674, 44.24046000000001, 28.993970000000004, -17.30107000000001, -20.85423, -59.49391, -45.29257000000007, -50.10680000000002, -106.68011000000001, -218.48383, -100.14722000000006, -184.02938999999998, -175.31181000000004, -148.83461, -180.59879999999998, -212.41172, -316.18795, -143.9026, -255.88810999999998, -209.25459, -231.58891999999997, -54.54272000000003, -10.703370000000007, -123.57526000000001, -190.01961999999997, -230.46922999999998, -284.25114, -299.67313, 93.28892999999994, 325.75565000000006, 473.88824, 520.9737799999999, 630.14831, 675.9633500000001, 638.0703000000001, 595.37037, 481.58407000000005, 418.39937999999995, 280.79435, 326.42161999999996, 386.84471999999994, 467.32165, 591.77885, 665.95105, 664.8690600000001, 617.93859, 538.19746, 379.89039, 373.6585, 374.63156, 268.9860799999999, 310.88374, 373.4908999999999, 414.43289000000004, 578.43103, 632.8387700000001, 589.96397, 402.78918, 340.33834999999993, 304.5515, 448.3202299999999, 425.08812, 433.13430000000005, 419.0410800000001, 100.76946999999996, 406.7780200000001, 394.49019, 341.38883, 213.41056999999995, 132.21354000000002, 25.53321999999997, -19.809889999999996, 175.53127999999992, 180.0428199999999, 152.42063999999993, 181.64278000000002, -1.400959999999941, -8.34170000000006, -83.54876999999999, -119.2688, -134.98239, -99.58076, -106.36898000000002, -74.35976999999991, -169.98602, -213.5192, -224.15890999999996, -246.46431, -200.68857, -173.13255999999998, -187.21251, -193.98306, -219.12741, -231.82957000000002, -169.30534999999998, -34.47478000000001, 47.01576, -113.21743000000004, 228.40773000000002, 394.98156000000006, 458.90310999999997, 286.38206, 407.26666, 301.76649999999995, 304.46913000000006, 222.22058000000004, 243.1123899999999, 276.72330999999997, 354.96668999999997, 370.87086, 251.97851000000003, 257.49875, 225.46382000000006, 237.05822, 247.05720000000008, 219.98928, 138.83061999999995, 92.31188999999995, 166.67381, 200.33672, 167.30991999999992, -14.281389999999988, -44.204990000000066, -67.60795999999993, -64.46397999999999, 0.8460000000000036, 72.60933999999997, 113.3772100000001, 87.79514000000006, 46.50299000000007, 10.305320000000052, 43.57736999999997, 115.11510999999996, 169.18772, 213.03744999999992, 283.10387000000003, 272.83338000000003, 257.85606999999993, 148.76773000000003, 203.8891900000001, 230.27790000000005, 138.4993599999999, 44.78967, 56.683989999999994, -62.14777000000004, -172.95002, -199.32888000000003, -243.99945000000002, -280.99066000000005, 78.61815999999988, 95.3618100000001, 237.22045000000003, 247.51066000000003, 332.4256600000001, 398.72119999999995, 376.29935, 350.03514000000007, 307.5998800000001, 227.09187000000009, 197.19983000000002, 292.2954000000001, 121.85534000000007, -17.679089999999974, 96.25837999999999, 229.40265, 350.76224, 327.43228999999997, 248.25354000000004, 303.33354999999995, 354.69578, 296.39595999999995, 19.75579999999991, 48.30473000000006, 17.87656000000004, -175.08564, -26.222110000000043, -182.36816, -32.23523, 133.91715999999997, 172.72919000000002, -136.63441, -343.20216, -790.8288699999999, -821.6856300000001, -797.4172, -771.9434699999999, -740.66476, -625.44058, -528.45101, -370.81616, -326.1771, -340.22391, -402.50832, 284.70423000000005, 264.05598]
    v2=[59.47607000000005, 133.58475999999996, 218.4837, 214.90103999999997, 254.85096999999996, 134.50063, 355.65107, 372.01240999999993, 187.85753, 76.86381999999998, -35.669550000000015, -76.26421000000005, -144.28190999999998, -147.46757000000002, -108.24970000000002, 52.16787999999997, 48.19475, 2.168890000000033, 148.28864, 103.93889999999993, 10.009040000000027, 47.406769999999995, 40.88998000000001, 6.094059999999985, -56.20863000000003, -60.45937999999995, -11.777209999999968, 18.66954999999996, -93.23589000000004, -87.36979000000002, -145.31024000000002, -167.44148, -156.84122999999997, -104.15993999999998, -98.40488999999997, 55.79105999999996, 111.47145000000006, 12.729370000000017, -14.876300000000015, 225.34524999999996, 327.97314, 263.69006, 86.86847, 20.50632999999999, -4.680049999999994, 33.54959000000002, -44.69394, -73.16809999999998, -44.59573999999998, -97.33447000000001, 20.160939999999982, 65.32898, 17.04674, 44.24046000000001, 28.993970000000004, -17.30107000000001, -20.85423, -59.49391, -140.57362999999998, -131.94833, -16.688530000000014, -218.48383, -100.14722000000006, -184.02938999999998, -175.31181000000004, -148.83461, -180.59879999999998, -212.41172, -316.18795, -380.88924, -424.99597000000006, -480.82022000000006, -231.58891999999997, -54.54272000000003, -10.703370000000007, -123.57526000000001, -190.01961999999997, -230.46922999999998, -284.25114, -299.67313, -315.20953000000003, -232.26439000000005, -122.05606, 520.9737799999999, 630.14831, 675.9633500000001, 638.0703000000001, 595.37037, 481.58407000000005, 418.39937999999995, 280.79435, 145.55732999999998, 47.039229999999975, 2.3445199999999886, 591.77885, 665.95105, 664.8690600000001, 617.93859, 538.19746, 379.89039, 373.6585, 374.63156, 318.66949999999997, 231.23213999999996, 133.08813999999995, 414.43289000000004, 578.43103, 632.8387700000001, 589.96397, 402.78918, 340.33834999999993, 304.5515, 448.3202299999999, 478.66759, 458.53541999999993, 480.98876999999993, 100.76946999999996, 406.7780200000001, 394.49019, 341.38883, 213.41056999999995, 132.21354000000002, 25.53321999999997, -19.809889999999996, 38.480600000000095, 44.61309000000006, 87.52230999999995, 181.64278000000002, -1.400959999999941, -8.34170000000006, -83.54876999999999, -119.2688, -134.98239, -99.58076, -106.36898000000002, -180.15524, -217.28583999999995, -152.80401999999998, -224.15890999999996, -246.46431, -200.68857, -173.13255999999998, -187.21251, -193.98306, -219.12741, -231.82957000000002, -284.04478, -382.63962000000004, -169.02761999999996, -113.21743000000004, 228.40773000000002, 394.98156000000006, 458.90310999999997, 286.38206, 407.26666, 301.76649999999995, 304.46913000000006, 211.63165000000004, 88.14441999999997, 168.4375, 354.96668999999997, 370.87086, 251.97851000000003, 257.49875, 225.46382000000006, 237.05822, 247.05720000000008, 219.98928, 170.61243000000002, 172.60365000000013, 136.25017000000003, 200.33672, 167.30991999999992, -14.281389999999988, -44.204990000000066, -67.60795999999993, -64.46397999999999, 0.8460000000000036, 72.60933999999997, 164.51772999999991, 142.57371000000012, 168.05257000000006, 10.305320000000052, 43.57736999999997, 115.11510999999996, 169.18772, 213.03744999999992, 283.10387000000003, 272.83338000000003, 257.85606999999993, 234.39965999999993, 166.03161, 16.111639999999966, 138.4993599999999, 44.78967, 56.683989999999994, -62.14777000000004, -172.95002, -199.32888000000003, -243.99945000000002, -280.99066000000005, -167.11854999999997, -38.32132999999999, -90.62842999999998, 247.51066000000003, 332.4256600000001, 398.72119999999995, 376.29935, 350.03514000000007, 307.5998800000001, 227.09187000000009, 197.19983000000002, 45.89661999999987, -141.37858000000006, -416.77750000000015, 96.25837999999999, 229.40265, 350.76224, 327.43228999999997, 248.25354000000004, 303.33354999999995, 354.69578, 296.39595999999995, 171.97690999999998, 129.53773, 92.07754999999997, -175.08564, -26.222110000000043, -182.36816, -32.23523, 133.91715999999997, 172.72919000000002, -136.63441, -343.20216, -196.82422999999994, -131.85260000000005, 37.831680000000006, -771.9434699999999, -740.66476, -625.44058, -528.45101, -370.81616, -326.1771, -340.22391, -402.50832, -411.31064000000003, -380.22421, -343.38667999999996, -34.268309999999985, -116.22897]
    fs=ut.marginals_cdf_inv([v1,v2])
    print('min1: %.1f, max1: %.1f'%(min(v1),max(v1)))
    x=[i/100 for i in range(100)]
    for f in fs:
        y=list(map(f,x))
        plt.figure()
        plt.plot(x,y)

def forecast_dependence(type='Wind'):
    parameter={'offsets':[15],'date_range':('2013-07-01 18:00:00','2015-07-05 01:00:00'),'first_hour':(-5,5)}
    titles=[{'type':type,'location':'NP','kind':'error'},{'type':type,'location':'NP','kind':'forecast'}]
    copula=ca.create_copulaManager(titles,parameter)
    copula.plot()
    copula.plot(which='vect')
    copula.tails()

def student_custom():
    parameters={'offsets':[8,13,18],'date_range':('2014-01-01 00:00:00','2015-12-31 23:00:00'),'first_hour':(-5,5)}
    titles=[{'type':'Wind','location':'total','kind':'error'}]
    cop=ca.create_copulaManager(titles,parameters)
    # u1=[0.4445092484586072, 0.4723379436760725, 0.4870021663056351, 0.5069988335277659, 0.498000333277807, 0.5078320279953547, 0.5793201133144722, 0.5734877520413507, 0.5958173637727301, 0.5581569738377171, 0.5608231961340012, 0.5528245292451489, 0.5388268621896574, 0.5461589735044386, 0.5483252791201695, 0.5451591401433321, 0.547992001333134, 0.508998500249979, 0.5056657223796238, 0.5049991668055528, 0.49250124979172105, 0.5113314447592275, 0.4930011664722743, 0.4811698050325136, 0.465172471254809, 0.4605065822363118, 0.4168471921346596, 0.42001333111149697, 0.3666888851858149, 0.47750374937512297, 0.7276287285452755, 0.7771204799200492, 0.8297783702716602, 0.9089318446925946, 0.8207798700217014, 0.6979670054991148, 0.720463256124012, 0.6853024495917653, 0.5526578903516312, 0.30586568905183376, 0.25337443759374045, 0.292701216463931, 0.3753541076487382, 0.40584902516248766, 0.36918846858858123, 0.3190301616397365, 0.33619396767206544, 0.34452591234795327, 0.4210131644726035, 0.446675554074338, 0.39135144142644285, 0.395350774870869, 0.472671221463108, 0.5984835860690142, 0.5649891684719451, 0.574654224295975, 0.5721546408932087, 0.5658223629395339, 0.5523246125645956, 0.5619896683886255, 0.5604899183469657, 0.3060323279453515, 0.3178636893851122, 0.43701049825030813, 0.6064822529578665, 0.5791534744209544, 0.4026828861856503, 0.46917180469923514, 0.5934844192634815, 0.7107982002999821, 0.6976337277120793, 0.7059656723879671, 0.982586235627443, 0.9910848191968485, 0.9945842359607214, 0.9895850691551887, 0.913431094817574, 0.7547908681886698, 0.5749875020830105, 0.632811198133672, 0.6101483086152572, 0.7627895350775221, 0.8166138976837575, 0.9350941509748824, 0.9420929845026281, 0.8402766205632789, 0.7797867022163333, 0.650641559740072, 0.2930344942509665, 0.2853691051491497, 0.3336943842692991, 0.7736210631561763, 0.9232627895351216, 0.9367605399100599, 0.765622396267324, 0.7787868688552267, 0.8106148975171182, 0.8142809531745089, 0.7586235627395782, 0.9639226795534542, 0.9614230961506879, 0.9624229295117944, 0.9622562906182767, 0.9655890684886318, 0.9762539576737682, 0.23721046492251807, 0.2615397433761105, 0.32736210631562435, 0.3711881353107943, 0.47217130478255476, 0.6476420596567524, 0.707465422429627, 0.8536077320446994, 0.811448091984707, 0.636977170471616, 0.41934677553742594, 0.24137643726046198, 0.7304615897350774, 0.9877520413264934, 0.99691718046997, 0.9915847358774018, 0.9787535410765346, 0.9155974004333048, 0.9070988168638993, 0.9239293451091927, 0.8996000666556002, 0.8259456757207518, 0.38601899683387464, 0.12656223962672775, 0.13989335110814827, 0.22937843692718352, 0.24370938176971058, 0.3080319946675646, 0.3550241626395719, 0.30786535577404683, 0.2942009665055908, 0.3076987168805291, 0.3463589401766486, 0.3340276620563346, 0.5083319446759079, 0.46183969338445385, 0.6461423096150926, 0.7187968671888344, 0.6598066988835486, 0.45184135977338846, 0.3950174970838335, 0.3271954674221066, 0.3036993834361029, 0.2535410764872582, 0.305699050158316, 0.24904182636227878, 0.25220796533911616, 0.4245125812364764, 0.4751708048658744, 0.4750041659723566, 0.4478420263289623, 0.4318446925512577, 0.4321779703382932, 0.45534077653726135, 0.4203466088985325, 0.4623396100650071, 0.4835027495417622, 0.4758373604399454, 0.6199800033328048, 0.682136310614928, 0.7309615064156306, 0.6961339776704195, 0.6644725879020458, 0.645142476253986, 0.6563072821196757, 0.5804865855690965, 0.47150474920848373, 0.4573404432594744, 0.46000666555575853, 0.5519913347775601, 0.58765205799036, 0.6169805032494852, 0.6121479753374702, 0.5976503916014254, 0.5989835027495675, 0.5784869188468834, 0.5594900849858592, 0.34269288451925795, 0.3803532744542709, 0.39101816363940733, 0.49100149975006124, 0.5443259456757433, 0.5786535577404012, 0.6069821696384198, 0.6189801699716982, 0.6043159473421357, 0.5871521413098068, 0.5551574737543975, 0.4670054990835043, 0.42884519246793806, 0.4340109981669885, 0.515830694884207, 0.5326612231295004, 0.5516580569905246, 0.5578236960506816, 0.5644892517913919, 0.5558240293284685, 0.5463256123979564, 0.5283286118980387, 0.30819863356108235, 0.3431928011998112, 0.4766705549075342, 0.5679886685552648, 0.581486418930203, 0.600649891684745, 0.6508081986335897, 0.6641393101150103, 0.658806865522442, 0.63147808698553, 0.5673221129811937, 0.5344942509581957, 0.6338110314947786, 0.6349775037494029, 0.5904849191801619, 0.5688218630228535, 0.6268121979670328, 0.6751374770871822, 0.6831361439760345, 0.6463089485086103, 0.5788201966339189, 0.5269955007498967, 0.3171971338110412, 0.33036160639894396, 0.3210298283619496, 0.344692551241471, 0.33352774537578134, 0.33919346775538506, 0.3475254124312729, 0.36368938510249527, 0.4061823029495232, 0.43001166472256236, 0.5773204465922591, 0.1305615730711539, 0.1597233794367613, 0.203049491751378, 0.35802366272289154, 0.6371438093651337, 0.6904682552908158, 0.8171138143643107, 0.8976003999333871, 0.9150974837527516, 0.939426762206344, 0.9224295950675329, 0.3198633561073253, 0.2808698550241703, 0.49066822196302573, 0.6036493917680646, 0.6616397267122439, 0.6868021996334251, 0.8062822862856566, 0.8499416763873088, 0.8129478420263668, 0.8276120646559294, 0.8014497583736416, 0.5353274454257845, 0.5438260289951901, 0.4160139976670708, 0.31619730044993466, 0.3523579403432878, 0.4740043326112501, 0.45450758206967257, 0.4481753041159978, 0.4271788035327605, 0.3703549408432055, 0.32852857857024864, 0.280369938343617, 0.24037660389935545, 0.2213797700383312, 0.26720546575571424, 0.30436593901017395, 0.39635060823197554, 0.33386102316281685, 0.2565405765705778, 0.17522079653391265, 0.13272787868688474, 0.22504582569572185, 0.8609398433594807, 0.8896017330445348, 0.797783702716251, 0.7186302282953166, 0.6871354774204607, 0.8226128978503967, 0.7599566738877203, 0.7714547575404455, 0.9015997333778133, 0.9199300116647665, 0.8639393434428003, 0.9137643726046095, 0.8599400099983742, 0.6518080319946963, 0.6843026162306588, 0.4900016663889547, 0.24187635394101525, 0.1550574904182641, 0.13006165639060063, 0.5878186968838778, 0.6283119480086926, 0.43317780369939973, 0.12506248958506794, 0.16572237960340053, 0.34919180136645045, 0.21554740876520972, 0.13489418430261557, 0.2720379936677292, 0.4366772204632726, 0.803949341776408, 0.84910848191972, 0.6993001166472569, 0.1915514080986528, 0.004082652891184802, 0.04790868188635247, 0.06840526578903543, 0.03174470921513076, 0.035077487085485755, 0.02607898683552739, 0.05257457090484946, 0.06157307115480794, 0.054740876520580205, 0.054407598733544706, 0.039243459423429494, 0.02691218130311612, 0.009915014164305958, 0.010748208631894697, 0.00474920846525579, 0.008248625229128479, 0.018580236627228814, 0.02907848691884682, 0.012414597567072175, 0.017747042159640083, 0.01791368105315783, 0.03324445925679051, 0.08256957173804355, 0.07040493251124834, 0.2122146308948546, 0.164722546242294, 0.13256123979336698, 0.20254957507082472, 0.17572071321446592, 0.18821863022829766, 0.28903516080654035, 0.35335777370439436, 0.3383602732877963, 0.4215130811531568, 0.6221463089485356, 0.5224962506249172, 0.39318446925513817, 0.6028161973004759, 0.6203132811198403, 0.9052657890352039, 0.8897683719380526, 0.9472587902016786, 0.9587568738544038, 0.8877687052158395, 0.677970338276984, 0.854607565405806, 0.8261123146142696, 0.8907682052991591, 0.9339276787202581, 0.9742542909515551, 0.9897517080487065, 0.9889185135811177, 0.9294284285952786, 0.8899350108315703, 0.8094484252624939, 0.8347775370771929, 0.8992667888685647, 0.868271954674262, 0.7864522579570435, 0.7366272287952343, 0.6836360606565878, 0.7571238126979184, 0.8579403432761611, 0.8009498416930884, 0.844275954007705, 0.8666055657390844, 0.6548075320780159, 0.8132811198134023, 0.9365939010165422, 0.9234294284286394, 0.7534577570405278, 0.2267122146308994, 0.11223129478420174, 0.14339276787202115, 0.2617063822696283, 0.07907015497417096, 0.14072654557573705, 0.15872354607565475, 0.293367772038002, 0.6701383102816495, 0.9445925679053945, 0.9597567072155103, 0.9469255124146431, 0.9415930678220749, 0.8951008165306208, 0.7811198133644753]
    # u2=[0.4761706382269809, 0.4970004999167005, 0.48750208298618836, 0.49783369438428926, 0.4858356940510108, 0.47950341609733604, 0.5846525579070404, 0.5474920846525807, 0.5504915847359003, 0.5421596400600125, 0.5274954174304499, 0.5354940843193022, 0.5376603899350331, 0.5348275287452312, 0.5373271121479976, 0.5361606398933733, 0.5341609731711602, 0.4946675554074519, 0.4816697217130669, 0.5014997500416799, 0.48216963839362015, 0.4700049991668239, 0.45450758206967257, 0.44884185969006885, 0.40518246958841664, 0.40851524745877177, 0.42167972004667453, 0.4866688885185996, 0.7186302282953166, 0.765622396267324, 0.8221129811698434, 0.9045992334611329, 0.8124479253458136, 0.6909681719713691, 0.7124645892351597, 0.6764705882353242, 0.5419930011664947, 0.5386602232961396, 0.734794200966539, 0.2880353274454338, 0.36485585735711956, 0.3950174970838335, 0.3590234960839981, 0.31203132811199075, 0.3290284952508019, 0.3363606065655832, 0.40934844192636055, 0.43467755374105954, 0.42651224795868947, 0.4098483586069138, 0.4620063322779716, 0.586985502416289, 0.5539910014997732, 0.5636560573238031, 0.5611564739210367, 0.5551574737543975, 0.5416597233794592, 0.5516580569905246, 0.5501583069488648, 0.5563239460090218, 0.5588235294117881, 0.42551241459758293, 0.5958173637727301, 0.5683219463423003, 0.3920179970005139, 0.45834027662058097, 0.5824862522913096, 0.7044659223463073, 0.6906348941843335, 0.6994667555407746, 0.7132977837027484, 0.7846192301283482, 0.9945842359607214, 0.990084985835742, 0.9089318446925946, 0.7451258123646399, 0.5639893351108386, 0.6233127812031599, 0.5996500583236385, 0.751958006998868, 0.8079486752208341, 0.919596733877731, 0.9520913181136935, 0.8344442592901574, 0.7682886185636081, 0.6408098650225243, 0.2883686052324693, 0.28103649391768804, 0.32652891184803556, 0.7622896183969688, 0.9184302616231067, 0.9320946508915627, 0.9544242626229421, 0.9795867355441233, 0.8011164805866061, 0.8054490918180678, 0.747792034660924, 0.9632561239793832, 0.9600899850025458, 0.9615897350442056, 0.9609231794701346, 0.964755874021043, 0.9755874020996972, 0.9240959840027104, 0.8257790368272341, 0.3203632727878786, 0.3616897183802822, 0.4616730544909361, 0.6384769205132758, 0.7009665055824345, 0.8492751208132377, 0.8021163139477127, 0.6273121146475861, 0.40751541409766523, 0.5719880019996909, 0.15455757373771084, 0.9882519580070467, 0.99691718046997, 0.9919180136644373, 0.9780869855024635, 0.9107648725212899, 0.9029328445259553, 0.9190968171971777, 0.8947675387435853, 0.8187802032994883, 0.7027995334111298, 0.8159473421096864, 0.13989335110814827, 0.22471254790868633, 0.23921013164473115, 0.30236627228796087, 0.3458590234960953, 0.3021996333944431, 0.2900349941676469, 0.30203299450092536, 0.33802699550076076, 0.2960339943342861, 0.23987668721880218, 0.45034160973172865, 0.636977170471616, 0.7111314780870176, 0.6508081986335897, 0.44034327612066326, 0.38451924679221483, 0.3201966338943608, 0.298866855524088, 0.24904182636227878, 0.2705382436260694, 0.22654557573738165, 0.2478753541076545, 0.4126812197967157, 0.46417263789370244, 0.4640059990001847, 0.4356773871021661, 0.4203466088985325, 0.420679886685568, 0.44384269288453615, 0.4086818863522895, 0.43351108148643525, 0.4678386935510931, 0.46483919346777347, 0.6104815864022927, 0.6739710048325579, 0.7221296450591895, 0.6893017830361915, 0.6558073654391224, 0.6358106982169917, 0.6466422262956458, 0.5699883352774778, 0.6171471421430029, 0.651308115314143, 0.4483419430095156, 0.541159806698906, 0.5769871688052236, 0.6063156140643488, 0.6016497250458516, 0.5864855857357357, 0.5874854190968423, 0.5676553907682292, 0.5491584735877583, 0.5339943342776424, 0.5404932511248349, 0.38018663556075316, 0.48016997167140707, 0.5334944175970892, 0.567822029661747, 0.5964839193468011, 0.6093151141476684, 0.5933177803699637, 0.5764872521246703, 0.5448258623562966, 0.5443259456757433, 0.5384935844026218, 0.42284619230129883, 0.5059990001666593, 0.522662889518435, 0.5409931678053882, 0.547325445759063, 0.5533244459257022, 0.5453257790368499, 0.53566072321282, 0.5179970004999378, 0.4950008331944874, 0.433677720379953, 0.46533911014832674, 0.5569905015830928, 0.5709881686385844, 0.5893184469255376, 0.6411431428095599, 0.6554740876520869, 0.6498083652724832, 0.6219796700550179, 0.5564905849025396, 0.547992001333134, 0.5661556407265694, 0.6249791701383375, 0.5796533911015077, 0.5578236960506816, 0.6169805032494852, 0.6666388935177766, 0.6748041993001467, 0.6373104482586515, 0.5679886685552648, 0.5163306115647602, 0.48683552741211733, 0.433011164805882, 0.3140309948342038, 0.33652724545910095, 0.32619563406100005, 0.3313614397600505, 0.3390268288618673, 0.3536910514914299, 0.39518413597735125, 0.4183469421763194, 0.5664889185136049, 0.6479753374437879, 0.6731378103649691, 0.19905015830695183, 0.3490251624729327, 0.6274787535411038, 0.6833027828695523, 0.8084485919013874, 0.8927678720213722, 0.9102649558407366, 0.9350941509748824, 0.9175970671555179, 0.9005999000167068, 0.8297783702716602, 0.47983669388437156, 0.5928178636894105, 0.6529745042493206, 0.6784702549575373, 0.7961173137810734, 0.8451091484752938, 0.803949341776408, 0.8202799533411481, 0.7907848691885052, 0.7182969505082811, 0.6101483086152572, 0.4045159140143456, 0.3095317447092244, 0.34335944009332897, 0.46300616563907815, 0.4428428595234296, 0.43617730378271935, 0.4153474420929998, 0.36068988501917565, 0.32152974504250287, 0.18338610231628272, 0.11239793367771948, 0.2175470754874228, 0.2628728545242526, 0.299533411098159, 0.3856857190468391, 0.3266955507415533, 0.2523746042326339, 0.17088818530245098, 0.13272787868688474, 0.22037993667722466, 0.26603899350108995, 0.17405432427928835, 0.7869521746375968, 0.7109648391934998, 0.6789701716380906, 0.8146142309615444, 0.7491251458090661, 0.7602899516747558, 0.8969338443593161, 0.9150974837527516, 0.8599400099983742, 0.841609731711421, 0.9424262622896636, 0.6419763372771486, 0.6756373937677355, 0.47917013831030053, 0.23704382602900032, 0.15272454590901552, 0.12956173971004736, 0.5771538076987414, 0.6183136143976272, 0.4218463589401923, 0.22621229795034614, 0.568488585235818, 0.3408598566905626, 0.21154807532078357, 0.13489418430261557, 0.2677053824362675, 0.4251791368105474, 0.7939510081653426, 0.8444425929012228, 0.6924679220130289, 0.18671888018663785, 0.1957173804365967, 0.18405265789035374, 0.07273787702049674, 0.035577403766039004, 0.038743542742876245, 0.029578403599400057, 0.05690718213631095, 0.06623896017330477, 0.05940676553907719, 0.059073487752041694, 0.043242792867855484, 0.025079153474420912, 0.054407598733544706, 0.013247792034660914, 0.005415764039326778, 0.010248291951341453, 0.021079820029995006, 0.03241126478920176, 0.015247458756873888, 0.02041326445592402, 0.020579903349441767, 0.0372437927012165, 0.04457590401599748, 0.0632394600899854, 0.2083819363439462, 0.1608898516913856, 0.13189468421929595, 0.19788368605232753, 0.1712214630894865, 0.18371938010331823, 0.2842026328945254, 0.344692551241471, 0.3306948841859795, 0.5839860023329694, 0.5118313614397808, 0.5124979170138518, 0.3831861356440728, 0.5919846692218217, 0.6108148641893282, 0.9009331778037423, 0.8847692051325199, 0.9439260123313234, 0.957257123812744, 0.8832694550908601, 0.8514414264289686, 0.45384102649560154, 0.8189468421930061, 0.8859356773871442, 0.9290951508082431, 0.9734210964839664, 0.9902516247292598, 0.989418430261671, 0.9247625395767815, 0.8851024829195554, 0.7996167305449463, 0.8119480086652603, 0.899766705549118, 0.8644392601233536, 0.7749541743043183, 0.7274620896517577, 0.6751374770871822, 0.7466255624062997, 0.8537743709382172, 0.7899516747209164, 0.8391101483086546, 0.8626062322946583, 0.912097983669432, 0.9110981503083254, 0.931928011998045, 0.9187635394101422, 0.7437927012164979, 0.22204632561240223, 0.1132311281453082, 0.14272621229795013, 0.2578736877187199, 0.08240293284452581, 0.14072654557573705, 0.5413264455924237, 0.6686385602399897, 0.6614730878187262, 0.9409265122480038, 0.9582569571738505, 0.9435927345442879, 0.9375937343776487, 0.8901016497250881, 0.7694550908182324, 0.25337443759374045, 0.05374104315947371]
    cop.plot()
    f=(mod.cop_student_custom(cop.unifM,v=2.1)).f
    res=f(5000)
    print('\n\n%r\n\n'%res)
    plt.figure()
    plt.plot(res[0],res[1],'.')

def compare_distributions():
    parameters={'offsets':[11,13,16],'date_range':('2013-01-01 18:00:00','2015-07-05 01:00:00'),'first_hour':(-2,2)}
    title1={'type':'Wind','location':'total','kind':'error'}
    titles=[title1]
    copula=ca.create_copulaManager(titles,parameters)
    ca.compare_distributions(copula)

def from_cop_to_dist(vects):
    unifs=[]
    unifs.append(mod.uniforms(vects))
    unifs.append(mod.uniforms(vects,rand=False))
    unifs.append(mod.cop_gaussian(unifs[0]).val)
    unifs.append(mod.cop_gaussian(vects).val)
    unifs.append(mod.cop_student(unifs[0]).val)
    unifs.append(mod.cop_student_custom(unifs[0]).f(len(vects[0])))
    F_inv=ut.marginals_cdf_inv(vects)
    dist=[[] for i in range(len(unifs))]
    for j in range(len(unifs)):
        for i in range(len(vects)):
            dist[j].append(list(map(F_inv[i],unifs[j][i])))

    mn,vr=np.mean(vects),np.sqrt(np.var(vects))
    def f(a):
        return(sc.stats.norm.ppf(a,mn,vr))
    temp=[]
    for i in range(len(vects)):
        temp.append(list(map(f,unifs[2][i])))
    dist.append(temp)
    temp=[]
    for i in range(len(vects)):
        temp.append(list(map(f,unifs[0][i])))
    dist.append(temp)

    titres=['empirical redistributed','empirical - ranks','gaussian copula from empirical copula',
            'gaussian copula from vectors','student copula from empirical copula','student copula customized','gaussian distribution','empirical to gaussian']
    plt.figure()
    plt.title('real distribution')
    plt.plot(vects[0],vects[1],'.')
    for i in range(len(dist)):
        plt.figure()
        plt.plot(dist[i][0],dist[i][1],'.')
        plt.title(titres[i])
    x=[i/100 for i in range(101)]
    y0=list(map(F_inv[0],x))
    y1=sc.stats.norm.ppf(x,np.mean(vects),np.sqrt(np.var(vects)))
    plt.figure()
    plt.plot(x,y0,c='blue')
    plt.plot(x,y1,c='red')

def customize(copula,visualize=True):
    unifs=copula.unifM
    dim=len(unifs)
    subsets=[]
    for i in range(dim):
        for j in range(i+1,dim):
            subsets.append(sub.create_diagonal([i,j]))
    subsets.append(sub.main_axis)
    subsets.append(sub.tail)

    # return subsets
    return mod.cop_customized(mod.cop_gaussian,unifs,subsets,visualize=visualize,testMode=True)



def space_cor(type='Wind', cop=None,nb=None):
    if cop is None:
        if nb is None:
            nb=24
        title1={'type':type,'location':'NP','kind':'error'}
        title2={'type':type,'location':'SP','kind':'error'}
        titles=[title1,title2]
        off=[i for i in range(2*nb+1)]
        parameter1={'offsets':[nb],'date_range':('2013-01-01 00:00:00','2015-12-31 23:00:00'),'first_hour':(-11,12)}
        parameter2={'offsets':off,'date_range':('2013-01-01 00:00:00','2015-12-31 23:00:00'),'first_hour':(-11,12)}
        parameters=[parameter1,parameter2]
        cop=ca.create_copulaManager(titles,parameter1,list_parameters=parameters)
    else:
        nb=cop.dim//2
        off=[i for i in range(nb)]
    cor=[]
    pearson=[]
    stdv=np.std(cop.vectM[0])
    stdu=np.std(cop.unifM[0])
    for i in range(2*nb+1):
        v=cop.vectM[i+1]
        u=cop.unifM[i+1]

        cor.append(np.cov(cop.vectM[0],v)[0][1]/(np.std(v)*stdv))
        pearson.append(np.cov(cop.unifM[0],u)[0][1]/(np.std(u)*stdu))

    print('correlation: %r \n Pearson\'s rho: %r'%(cor,pearson))
    plt.figure()
    ax=plt.subplot()
    levels=[0.1,0.2,0.5]
    for i in range(3):
        i=2-i
        ax.fill_between([-nb,nb],[-levels[i],-levels[i]],[levels[i],levels[i]], color=(0.7+i*0.1,0.7+i*0.1,0.7+i*0.1))
    plt.title('space correlation in %s power forecast errors with time offset'%type)
    abs=[i-nb for i in range(nb*2+1)]
    plt.plot(abs,cor,label='correlation')
    plt.plot(abs,pearson,label='pearson\'s rho')
    plt.plot([-nb,nb],[0,0],c='black')
    plt.xlabel("time interval")
    plt.ylabel("correlation")
    plt.legend()
    return cop


def main(args=None):
    # Parse command-line options.
    print ("hello")
    try:
        options_parser, guiOverride = MasterOptions.construct_options_parser()
        (options, args) = options_parser.parse_args(args=args)
    except SystemExit:
        # the parser throws a system exit if "-h" is specified - catch
        # it to exit gracefully.
        return

    # l=ca.get_data(type='Solar')
    # dico=ut.prepare_solar(l)
    # test(2)
    # spatial_correlation(offset_max=400)
    # type_correlation()
    # tails()
    # forecast_dependence()
    # student_custom()
    # marginals_test()
    # compare_distributions()


    plt.show()

main(sys.argv)
